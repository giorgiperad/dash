<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRYPTO COLLECTIVE X - Desktop Pro</title>

<!-- Inter font (optional but matches the design) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
/* ──────────────────────────────────────────────────────────────
   ORIGINAL STYLE – unchanged (kept exactly as you posted)      */
* { margin:0; padding:0; box-sizing:border-box; }
@keyframes gradientFlow {0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
@keyframes fadeInUp {from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes shimmerEffect {0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
@keyframes hoverFloat {0%,100%{transform:translateY(0)}50%{transform:translateY(-1px)}}
@keyframes neonGlow {0%,100%{filter:drop-shadow(0 0 4px #00ffff)}50%{filter:drop-shadow(0 0 20px #00ffff)}}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#050505;color:#fff;min-height:100vh;overflow-x:hidden}
.grain-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");opacity:.03;pointer-events:none;z-index:1}
.navbar{background:rgba(10,10,10,.9);backdrop-filter:blur(20px);border-bottom:1px solid rgba(139,92,246,.2);padding:20px 60px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.4)}
.logo-section{display:flex;align-items:center;gap:16px}
.logo-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;animation:hoverFloat 6s ease-in-out infinite,neonGlow 3s linear infinite;overflow:hidden;position:relative}
.logo-icon img{width:44px;height:44px;object-fit:contain;filter:brightness(0) invert(1)}
.logo-text{display:flex;flex-direction:column}
.logo-title{font-size:24px;font-weight:900;letter-spacing:1px;background:linear-gradient(135deg,#8b5cf6,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo-subtitle{font-size:11px;color:#666;text-transform:uppercase;letter-spacing:2px;font-weight:700}
.nav-right{display:flex;align-items:center;gap:20px}

/* ────── NEW: Auth buttons (login / register) ────── */
.auth-buttons{display:flex;gap:12px}
.auth-btn{padding:8px 20px;background:transparent;border:1px solid rgba(139,92,246,.4);color:#bbb;font-size:13px;font-weight:700;border-radius:12px;cursor:pointer;transition:all .3s}
.auth-btn:hover{background:rgba(139,92,246,.15);border-color:#8b5cf6;color:#fff}
.auth-btn.primary{background:linear-gradient(135deg,#8b5cf6,#ec4899);border:none;color:#fff}
.auth-btn.primary:hover{box-shadow:0 4px 16px rgba(139,92,246,.4)}

/* ────── NEW: Logged-in user menu ────── */
.user-menu{display:flex;align-items:center;gap:12px}
.user-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid #8b5cf6}
.user-name{font-size:14px;font-weight:600;color:#ddd}

/* ────── NEW: Admin-only controls (hidden until login) ────── */
.admin-controls{display:none;gap:12px;align-items:center}
.admin-controls.show{display:flex}
.admin-btn{padding:6px 16px;background:rgba(139,92,246,.1);border:1px solid rgba(139,92,246,.3);color:#8b5cf6;font-size:12px;font-weight:700;border-radius:12px;cursor:pointer;transition:all .3s}
.admin-btn:hover{background:rgba(139,92,246,.2);transform:translateY(-2px)}

/* ────── NEW: Modal (Add Token) ────── */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);align-items:center;justify-content:center;z-index:1000}
.modal.show{display:flex}
.modal-content{background:#0d0d0d;border:2px solid #1a1a1a;border-radius:20px;padding:32px;width:420px;max-width:90vw;box-shadow:0 20px 60px rgba(0,0,0,.6)}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-title{font-size:20px;font-weight:800;background:linear-gradient(135deg,#8b5cf6,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.close-modal{cursor:pointer;color:#666;font-size:24px;font-weight:300}
.modal-input{margin-bottom:16px}
.modal-input label{display:block;font-size:12px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:1px}
.modal-input input{width:100%;padding:12px 16px;background:#0a0a0a;border:1px solid #1a1a1a;border-radius:12px;color:#fff;font-size:14px}
.modal-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:24px}
.modal-btn{padding:10px 20px;border-radius:12px;font-weight:700;font-size:13px;cursor:pointer}
.modal-btn.cancel{background:transparent;border:1px solid #666;color:#aaa}
.modal-btn.cancel:hover{background:rgba(255,255,255,.05)}
.modal-btn.add{background:linear-gradient(135deg,#8b5cf6,#ec4899);border:none;color:#fff}
.modal-btn.add:hover{box-shadow:0 4px 16px rgba(139,92,246,.4)}

/* ────── Rest of original CSS (unchanged) ────── */
.live-indicator{display:flex;align-items:center;gap:8px;padding:8px 16px;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3);border-radius:20px}
.live-dot{width:8px;height:8px;background:#10b981;border-radius:50%;box-shadow:0 0 12px #10b981;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.live-text{font-size:12px;color:#10b981;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.time-display{font-size:14px;color:#888;font-weight:600;font-variant-numeric:tabular-nums}
.container{max-width:1920px;margin:0 auto;padding:48px 60px;position:relative;z-index:2}
.hero-section{display:grid;grid-template-columns:repeat(4,1fr);gap:24px;margin-bottom:48px}
.hero-stat{background:rgba(0,0,0,.2);backdrop-filter:blur(10px);border-radius:20px;padding:24px;border:1px solid rgba(255,255,255,.2)}
.hero-stat-label{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;opacity:.8;margin-bottom:8px;font-weight:700}
.hero-stat-value{font-size:32px;font-weight:900;text-shadow:2px 2px 4px rgba(0,0,0,.2)}
.content-grid{display:grid;grid-template-columns:380px 1fr;gap:32px;margin-bottom:48px}
.sidebar-section{display:flex;flex-direction:column;gap:24px}
.featured-card{background:#0d0d0d;border:2px solid #1a1a1a;border-radius:24px;padding:32px;transition:all .4s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}
.featured-card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(139,92,246,.1),transparent);transition:left .5s}
.featured-card:hover::before{left:100%}
.featured-card:hover{border-color:#8b5cf6;transform:translateY(-8px);box-shadow:0 24px 64px rgba(139,92,246,.25)}
.card-badge{display:inline-block;font-size:10px;text-transform:uppercase;letter-spacing:2px;font-weight:900;padding:6px 12px;border-radius:12px;margin-bottom:20px}
.badge-gainer{background:rgba(16,185,129,.15);color:#10b981;border:1px solid rgba(16,185,129,.3)}
.badge-gold{background:rgba(245,158,11,.15);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}
.badge-loss{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.featured-header{display:flex;align-items:center;gap:20px;margin-bottom:24px}
.featured-icon{width:72px;height:72px;border-radius:50%;border:3px solid #1a1a1a;box-shadow:0 8px 24px rgba(0,0,0,.5);transition:all .4s}
.featured-card:hover .featured-icon{transform:rotate(10deg) scale(1.1);border-color:#8b5cf6;box-shadow:0 12px 32px rgba(139,92,246,.4)}
.featured-info h3{font-size:22px;font-weight:800;margin-bottom:6px}
.featured-price{font-size:18px;color:#888;font-weight:700}
.progress-section{margin-top:24px}
.progress-label{display:flex;justify-content:space-between;margin-bottom:12px;font-size:13px;font-weight:700}
.progress-bar{height:12px;background:#1a1a1a;border-radius:6px;overflow:hidden;position:relative}
.progress-fill{height:100%;border-radius:6px;position:relative;overflow:hidden;transition:width 1.2s cubic-bezier(.4,0,.2,1)}
.progress-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:shimmerEffect 2s infinite}
.progress-fill.green{background:linear-gradient(90deg,#10b981,#059669);box-shadow:0 0 16px rgba(16,185,129,.5)}
.progress-fill.gold{background:linear-gradient(90deg,#f59e0b,#d97706);box-shadow:0 0 16px rgba(245,158,11,.5)}
.progress-fill.red{background:linear-gradient(90deg,#ef4444,#dc2626);box-shadow:0 0 16px rgba(239,68,68,.5)}
.progress-value{color:#10b981;font-size:18px}
.progress-value.negative{color:#ef4444}
.progress-value.gold{color:#f59e0b}
.main-section{background:#0d0d0d;border:2px solid #1a1a1a;border-radius:24px;padding:40px;min-height:800px}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;padding-bottom:24px;border-bottom:2px solid #1a1a1a}
.section-title{font-size:28px;font-weight:900;background:linear-gradient(135deg,#fff,#888);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.filter-tabs{display:flex;gap:12px;background:#0a0a0a;padding:6px;border-radius:16px;border:1px solid #1a1a1a}
.filter-tab{padding:10px 24px;border:none;background:transparent;color:#666;font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;cursor:pointer;border-radius:12px;transition:all .3s}
.filter-tab:hover{color:#8b5cf6}
.filter-tab.active{background:linear-gradient(135deg,#8b5cf6,#ec4899);color:#fff;box-shadow:0 4px 16px rgba(139,92,246,.3)}
.table-header{display:grid;grid-template-columns:80px 2fr 1fr 1fr 1fr;gap:24px;padding:16px 24px;margin-bottom:16px;border-radius:16px;background:#0a0a0a}
.table-header-cell{font-size:11px;color:#666;text-transform:uppercase;letter-spacing:1.5px;font-weight:800}
.tokens-list{display:flex;flex-direction:column;gap:12px}
.token-row{display:grid;grid-template-columns:80px 2fr 1fr 1fr 1fr;gap:24px;padding:20px 24px;background:#0a0a0a;border:2px solid #1a1a1a;border-radius:16px;align-items:center;transition:all .3s cubic-bezier(.4,0,.2,1);animation:fadeInUp .5s ease-out backwards;animation-delay:calc(var(--index)*.03s)}
.token-row:hover{border-color:#8b5cf6;transform:translateX(8px);box-shadow:0 8px 32px rgba(139,92,246,.2);background:#0f0f0f}
.token-icon-col{display:flex;align-items:center;justify-content:center}
.token-icon{width:56px;height:56px;border-radius:50%;border:2px solid #1a1a1a;transition:all .3s}
.token-row:hover .token-icon{border-color:#8b5cf6;transform:scale(1.15);box-shadow:0 8px 24px rgba(139,92,246,.4)}
.token-name-col h3{font-size:18px;font-weight:800;margin-bottom:4px}
.token-symbol{font-size:13px;color:#666;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.token-price-col{font-size:18px;font-weight:800;color:#fff}
.token-change-col{text-align:right}
.change-badge{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:12px;font-size:15px;font-weight:900;transition:all .3s}
.token-row:hover .change-badge{transform:scale(1.1)}
.change-badge.positive{background:rgba(16,185,129,.15);color:#10b981;border:1px solid rgba(16,185,129,.3)}
.change-badge.negative{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.3)}
.token-mcap-col{font-size:15px;font-weight:700;color:#666}
.loading{text-align:center;padding:120px}
.spinner{width:80px;height:80px;border:6px solid #1a1a1a;border-top:6px solid #8b5cf6;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 24px;box-shadow:0 0 40px rgba(139,92,246,.3)}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-size:16px;color:#666;font-weight:600}
.error{background:rgba(239,68,68,.1);border:2px solid rgba(239,68,68,.3);color:#ef4444;border-radius:16px;padding:24px;margin:24px 0;font-weight:700;text-align:center}
@media(max-width:1600px){.content-grid{grid-template-columns:340px 1fr}}
@media(max-width:1400px){.content-grid{grid-template-columns:1fr}.hero-section{grid-template-columns:repeat(2,1fr)}}
@media(max-width:1024px){.navbar{padding:16px 32px}.container{padding:32px}.token-row{grid-template-columns:60px 1.5fr 1fr 1fr}.token-mcap-col{display:none}.table-header{grid-template-columns:60px 1.5fr 1fr 1fr}.table-header-cell:last-child{display:none}}
/* ────── ANIMATED SVG ARROW ────── */
.change-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 900;
  transition: all .3s;
  position: relative;
  overflow: hidden;
}

.change-arrow {
  width: 18px;
  height: 18px;
  transition: transform .3s ease, filter .3s ease;
}

.change-badge:hover .change-arrow {
  transform: translateY(-2px) scale(1.2);
  filter: drop-shadow(0 0 8px currentColor);
}

/* Pulse animation on load */
@keyframes arrowPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}
.change-arrow {
  animation: arrowPulse 1.5s ease-in-out infinite;
}

/* Positive / Negative colors (keep your existing) */
.change-badge.positive { 
  background: rgba(16, 185, 129, 0.15); 
  color: #10b981; 
  border: 1px solid rgba(16, 185, 129, 0.3); 
}
.change-badge.negative { 
  background: rgba(239, 68, 68, 0.15); 
  color: #ef4444; 
  border: 1px solid rgba(239, 68, 68, 0.3); 
}

.change-value {
  font-variant-numeric: tabular-nums;
}
</style>
</head>
<body>

<div class="grain-overlay"></div>

<nav class="navbar">
  <div class="logo-section">
    <div class="logo-icon"><img src="https://ta3bviqjtxy1kv7x.public.blob.vercel-storage.com/sticker.webp" alt="Logo"></div>
    <div class="logo-text">
      <div class="logo-title">CRYPTO COLLECTIVE X</div>
      <div class="logo-subtitle"></div>
    </div>
  </div>

  <div class="nav-right">
    <div class="live-indicator"><div class="live-dot"></div><div class="live-text">Live</div></div>
    <div class="time-display" id="navTime">--:--:--</div>

    <!-- AUTH UI -->
    <div id="authContainer">
      <div class="auth-buttons">
        <button class="auth-btn" id="loginBtn">Login</button>
        <button class="auth-btn primary" id="registerBtn">Register</button>
      </div>
    </div>

    <div id="userContainer" class="user-menu" style="display:none;">
      <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
      <span id="userName" class="user-name"></span>
      <button class="auth-btn" id="logoutBtn">Logout</button>
    </div>

    <!-- ADMIN CONTROLS (hidden until login) -->
    <div id="adminControls" class="admin-controls">
      <button class="admin-btn" id="addTokenBtn">Add Token</button>
      <button class="admin-btn" id="refreshBtn">Refresh Now</button>
    </div>
  </div>
</nav>

<div class="container">
  <div id="loading" class="loading"><div class="spinner"></div><div class="loading-text">Loading market data...</div></div>
  <div id="error"></div>

  <div class="hero-section" id="heroStats" style="display:none;"></div>

  <div class="content-grid" id="contentGrid" style="display:none;">
    <div class="sidebar-section" id="sidebarSection"></div>

    <div class="main-section">
      <div class="section-header">
        <div class="section-title">Market Overview</div>
        <div class="filter-tabs">
          <button class="filter-tab" onclick="sortBy('name')" id="sortName">Name</button>
          <button class="filter-tab" onclick="sortBy('price')" id="sortPrice">Price</button>
          <button class="filter-tab active" onclick="sortBy('change')" id="sortChange">24h</button>
          <button class="filter-tab" onclick="sortBy('mcap')" id="sortMcap">MCap</button>
        </div>
      </div>

      <div class="table-header">
        <div class="table-header-cell">#</div>
        <div class="table-header-cell">Asset</div>
        <div class="table-header-cell">Price</div>
        <div class="table-header-cell">24h Change</div>
        <div class="table-header-cell">Market Cap</div>
      </div>

      <div class="tokens-list" id="tokensList"></div>
    </div>
  </div>
</div>

<!-- ────── MODAL: Add Token ────── -->
<div id="addTokenModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Add New Token</div>
      <span class="close-modal" id="closeModal">x</span>
    </div>
    <div class="modal-input">
      <label>CoinGecko ID</label>
      <input type="text" id="newTokenId" placeholder="e.g. bitcoin, ethereum, solana">
    </div>
    <div class="modal-actions">
      <button class="modal-btn cancel" id="cancelAdd">Cancel</button>
      <button class="modal-btn add" id="confirmAdd">Add Token</button>
    </div>
  </div>
</div>

<!-- ────── Firebase SDKs ────── -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
/* ────── Firebase Config (replace with yours) ────── */
const firebaseConfig = {
  apiKey: "AIzaSyARWG4t3i_pCpu-pOZPqauRufMQhZaI14U",
  authDomain: "ccx-dashboard.firebaseapp.com",
  databaseURL: "https://ccx-dashboard-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ccx-dashboard",
  storageBucket: "ccx-dashboard.firebasestorage.app",
  messagingSenderId: "413950601775",
  appId: "1:413950601775:web:53ca78e202ef7ec884b4da"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

/* ────── Global vars ────── */
let tokenIds = [], cryptoData = [], globalData = null, fearGreedData = null;
let sortColumn = 'change', sortDirection = 'desc';
let currentUser = null;

/* ────── Helpers ────── */
function $(id){return document.getElementById(id);}
function formatPrice(p){if(p>=1000)return p.toLocaleString('en-US',{maximumFractionDigits:0});if(p>=1)return p.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});if(p>=.01)return p.toFixed(4);return p.toFixed(6);}
function formatMarketCap(m){if(m>=1e12)return `${(m/1e12).toFixed(2)}T`;if(m>=1e9)return `${(m/1e9).toFixed(2)}B`;if(m>=1e6)return `${(m/1e6).toFixed(2)}M`;return m.toLocaleString('en-US',{maximumFractionDigits:0});}
function updateTime(){$('navTime').textContent=new Date().toLocaleTimeString('en-US',{hour12:false});}
updateTime();setInterval(updateTime,1000);

/* ────── AUTH UI HANDLERS ────── */
$('loginBtn').onclick = () => showAuthModal('login');
$('registerBtn').onclick = () => showAuthModal('register');
$('logoutBtn').onclick = () => auth.signOut();

function showAuthModal(mode){
  const email = prompt(`Enter your ${mode === 'login' ? 'email' : 'email (for registration)'}:`);
  if(!email) return;
  const password = prompt('Enter password:');
  if(!password) return;

  if(mode==='login'){
    auth.signInWithEmailAndPassword(email,password).catch(err=>alert(err.message));
  }else{
    auth.createUserWithEmailAndPassword(email,password).catch(err=>alert(err.message));
  }
}

/* ────── Auth state listener ────── */
auth.onAuthStateChanged(user=>{
  currentUser = user;
  if(user){
    // LOGGED IN
    $('authContainer').style.display='none';
    $('userContainer').style.display='flex';
    $('userName').textContent = user.email.split('@')[0];
    // use a placeholder avatar (you can upload real ones later)
    $('userAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.email)}&background=8b5cf6&color=fff&size=64`;
    $('adminControls').classList.add('show');
  }else{
    // LOGGED OUT
    $('authContainer').style.display='flex';
    $('userContainer').style.display='none';
    $('adminControls').classList.remove('show');
  }
});

/* ────── ADMIN: Add Token Modal ────── */
$('addTokenBtn').onclick = () => $('addTokenModal').classList.add('show');
$('closeModal').onclick = $('cancelAdd').onclick = () => $('addTokenModal').classList.remove('show');
$('confirmAdd').onclick = async () => {
  const id = $('newTokenId').value.trim().toLowerCase();
  if(!id){alert('Enter a CoinGecko ID');return;}
  const newKey = db.ref('tokens').push().key;
  await db.ref(`tokens/${newKey}`).set({id});
  alert(`Token "${id}" added!`);
  $('newTokenId').value='';
  $('addTokenModal').classList.remove('show');
  fetchAll(); // refresh immediately
};

/* ────── ADMIN: Force refresh ────── */
$('refreshBtn').onclick = () => fetchAll();

/* ────── Load token IDs from Firebase ────── */
async function loadTokenIds(){
  const snap = await db.ref('tokens').once('value');
  const obj = snap.val()||{};
  tokenIds = Object.values(obj).map(t=>t.id||t);
}

/* ────── Fetch everything ────── */
async function fetchAll(){
  const err = $('error'), load = $('loading');
  err.innerHTML=''; load.style.display='block';
  try{
    await loadTokenIds();
    if(!tokenIds.length){throw new Error('No tokens in DB');}
    const ids = tokenIds.join(',');
    const [main,globalRes,fgRes] = await Promise.allSettled([
      fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=250&page=1&sparkline=false&price_change_percentage=24h`),
      fetch('https://api.coingecko.com/api/v3/global'),
      fetch('https://api.alternative.me/fng/')
    ]);
    if(main.status==='fulfilled') cryptoData = await main.value.json();
    if(globalRes.status==='fulfilled'){const g=await globalRes.value.json();globalData=g.data;}
    if(fgRes.status==='fulfilled'){const f=await fgRes.value.json();fearGreedData=f.data[0];}
    renderAll();
    $('contentGrid').style.display='grid';
    $('heroStats').style.display='grid';
  }catch(e){
    console.error(e);
    err.innerHTML=`<div class="error">Warning: ${e.message||'Network error'}</div>`;
  }finally{
    load.style.display='none';
  }
}

/* ────── Render ────── */
function renderAll(){renderHero();renderSidebar();sortData();}
function renderHero(){
  let html='';
  if(globalData){
    const mc = (globalData.total_market_cap.usd/1e12).toFixed(2);
    const vol = (globalData.total_volume.usd/1e9).toFixed(1);
    const btcDom = globalData.market_cap_percentage.btc.toFixed(1);
    html+=`<div class="hero-stat"><div class="hero-stat-label">Market Cap</div><div class="hero-stat-value">${mc}T</div></div>
           <div class="hero-stat"><div class="hero-stat-label">24h Volume</div><div class="hero-stat-value">${vol}B</div></div>
           <div class="hero-stat"><div class="hero-stat-label">BTC Dominance</div><div class="hero-stat-value">${btcDom}%</div></div>`;
  }
  if(fearGreedData){
    html+=`<div class="hero-stat"><div class="hero-stat-label">Fear & Greed</div><div class="hero-stat-value">${fearGreedData.value}</div></div>`;
  }
  $('heroStats').innerHTML=html;
}
function renderSidebar(){
  const sorted = [...cryptoData].sort((a,b)=>(b.price_change_percentage_24h||0)-(a.price_change_percentage_24h||0));
  const top = sorted[0];
  const gold = cryptoData.find(t=>t.id==='tether-gold');
  let html='';
  if(top){
    const ch = top.price_change_percentage_24h||0;
    const w = Math.min(Math.abs(ch)*3,100);
    html+=`<div class="featured-card">
      <div class="card-badge badge-gainer">Top Gainer 24H</div>
      <div class="featured-header"><img src="${top.image}" class="featured-icon"><div class="featured-info"><h3>${top.name}</h3><div class="featured-price">${formatPrice(top.current_price)}</div></div></div>
      <div class="progress-section"><div class="progress-label"><span>24h Performance</span><span class="progress-value">+${ch.toFixed(2)}%</span></div>
      <div class="progress-bar"><div class="progress-fill green" style="width:${w}%"></div></div></div></div>`;
  }
  if(gold){
    const ch = gold.price_change_percentage_24h||0;
    const neg = ch<0;
    const w = Math.min(Math.abs(ch)*10,100);
    const badge = neg?'badge-loss':'badge-gold';
    const fill = neg?'red':'gold';
    const valCls = neg?'negative':'gold';
    const sign = neg?'':' +';
    html+=`<div class="featured-card">
      <div class="card-badge ${badge}">Gold 24H</div>
      <div class="featured-header"><img src="${gold.image}" class="featured-icon"><div class="featured-info"><h3>${gold.name}</h3><div class="featured-price">${formatPrice(gold.current_price)}</div></div></div>
      <div class="progress-section"><div class="progress-label"><span>24h Performance</span><span class="progress-value ${valCls}">${sign}${Math.abs(ch).toFixed(2)}%</span></div>
      <div class="progress-bar"><div class="progress-fill ${fill}" style="width:${w}%"></div></div></div></div>`;
  }
  $('sidebarSection').innerHTML=html;
}

/* ────── Sorting ────── */
function sortBy(col){
  if(sortColumn===col) sortDirection=sortDirection==='asc'?'desc':'asc';
  else{sortColumn=col;sortDirection=col==='name'?'asc':'desc';}
  document.querySelectorAll('.filter-tab').forEach(b=>b.classList.remove('active'));
  $('sort'+col.charAt(0).toUpperCase()+col.slice(1)).classList.add('active');
  sortData();
}
function sortData(){
  cryptoData.sort((a,b)=>{
    let av,bv;
    if(sortColumn==='name'){av=a.name.toLowerCase();bv=b.name.toLowerCase();}
    else if(sortColumn==='price'){av=a.current_price||0;bv=b.current_price||0;}
    else if(sortColumn==='change'){av=a.price_change_percentage_24h||0;bv=b.price_change_percentage_24h||0;}
    else if(sortColumn==='mcap'){av=a.market_cap||0;bv=b.market_cap||0;}
    return sortDirection==='asc'?(av>bv?1:av<bv?-1:0):(av<bv?1:av>bv?-1:0);
  });
  renderTokenList();
}
function renderTokenList(){
  const html = cryptoData.map((t,i)=>{
    const ch = t.price_change_percentage_24h||0;
    const isPositive = ch >= 0;
    const cls = isPositive ? 'positive' : 'negative';
    const absChange = Math.abs(ch).toFixed(2);

    // Animated SVG Arrow (inline)
    const arrowSvg = isPositive 
      ? `<svg class="change-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
           <path d="M12 19V5M5 12l7-7 7 7"/>
         </svg>`
      : `<svg class="change-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
           <path d="M12 5v14M19 12l-7 7-7-7"/>
         </svg>`;

    return `<div class="token-row" style="--index:${i}">
      <div class="token-icon-col"><img src="${t.image}" class="token-icon"></div>
      <div class="token-name-col"><h3>${t.name}</h3><div class="token-symbol">${t.symbol.toUpperCase()}</div></div>
      <div class="token-price-col">${formatPrice(t.current_price)}</div>
      <div class="token-change-col">
        <span class="change-badge ${cls}">
          ${arrowSvg}
          <span class="change-value">${absChange}%</span>
        </span>
      </div>
      <div class="token-mcap-col">${formatMarketCap(t.market_cap||0)}</div>
    </div>`;
  }).join('');
  document.getElementById('tokensList').innerHTML=html;
}

/* ────── Auto-refresh (90 s) ────── */
fetchAll();
setInterval(fetchAll,90000);
</script>
</body>
</html>
